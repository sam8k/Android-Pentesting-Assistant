#!/usr/bin/env python

import subprocess
import optparse 

def get_input():
    parse = optparse.OptionParser()
    parse.add_option("-p", "--package", dest="package", help="Enter the Package Name")
    parse.add_option("-o", "--output", dest="output", help="Enter the Output Path")
    (options, arguments) = parse.parse_args()
    if not options.package:
        print("[-] Enter -h for Help")
        exit()
    elif not options.output:
        print("[-] Enter -h for Help")
        exit()
    return options

def execute_remotely(command):
    return subprocess.check_output(command, shell=True)

def execute(command):
    return subprocess.run(command, shell=True)

if __name__ == "__main__":
    options = get_input()
    package_name = options.package
    output_path = options.output
    apk_path = execute_remotely('adb shell pm path ' + str(package_name))
    apks = apk_path.decode("utf-8").splitlines()
    for apk in apks:
        apk = apk.replace('package:', '')
        # if "base.apk" in apk:
        #     apk = apk.replace('base.apk', package_name)
        apk_path = execute('adb pull '+ apk + ' "' + str(output_path) + '"')
        print(apk)
